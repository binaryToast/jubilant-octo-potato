<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sumo Scrandle</title>
<style>
  body { font-family: system-ui, sans-serif; background: #0b1220; color: #eee; padding: 20px; }
  h1 { margin-top: 0; }
  .match {
    display: flex; 
    flex-direction: column; 
    padding: 10px; 
    margin-bottom: 10px; 
    background: #202a3a; 
    border-radius: 6px;
  }
  .bout-header { font-weight: bold; margin-bottom: 5px; }
  label { display: block; margin: 2px 0; cursor: pointer; }
  input[type="radio"] { margin-right: 6px; }
  .correct { background: #144c26; }
  .wrong { background: #5a1c1c; }
  .raw { font-size: 0.85em; color: #aaa; margin-top: 4px; }
</style>
</head>
<body>
<h1>Sumo Scrandle</h1>
<p>Pick the winners for todayâ€™s Makuuchi bouts!</p>
<div id="matches"></div>

<script>
async function loadMatches() {
  try {
    const res = await fetch('matches.json');
    if (!res.ok) throw new Error("Failed to fetch matches.json");
    const data = await res.json();

    const banzuke = data.banzuke;
    const day = data.day;
    const matches = data.matches;

    const key = `${banzuke}-${day}-picks`;
    let saved = JSON.parse(localStorage.getItem(key) || '{}');

    const container = document.getElementById('matches');
    container.innerHTML = '';

    matches.forEach((m, i) => {
      const matchDiv = document.createElement('div');
      matchDiv.className = 'match';

      const header = document.createElement('div');
      header.className = 'bout-header';
      header.textContent = `Bout ${m.bout}`;
      matchDiv.appendChild(header);

      const eastName = m.east || "Unknown East";
      const westName = m.west || "Unknown West";

      // East radio
      const eastLabel = document.createElement('label');
      const eastInput = document.createElement('input');
      eastInput.type = 'radio';
      eastInput.name = `match-${i}`;
      eastInput.value = eastName;
      if (saved[i] === eastName) eastInput.checked = true;
      eastInput.addEventListener('change', () => {
        saved[i] = eastName;
        localStorage.setItem(key, JSON.stringify(saved));
      });
      eastLabel.appendChild(eastInput);
      eastLabel.append(` ${eastName} (East)`);

      // West radio
      const westLabel = document.createElement('label');
      const westInput = document.createElement('input');
      westInput.type = 'radio';
      westInput.name = `match-${i}`;
      westInput.value = westName;
      if (saved[i] === westName) westInput.checked = true;
      westInput.addEventListener('change', () => {
        saved[i] = westName;
        localStorage.setItem(key, JSON.stringify(saved));
      });
      westLabel.appendChild(westInput);
      westLabel.append(` ${westName} (West)`);

      matchDiv.appendChild(eastLabel);
      matchDiv.appendChild(westLabel);

      // show result if winner present
      if (m.winner) {
        if (saved[i] === m.winner) {
          matchDiv.classList.add('correct');
        } else {
          matchDiv.classList.add('wrong');
        }
        const result = document.createElement('div');
        result.textContent = `Winner: ${m.winner}`;
        matchDiv.appendChild(result);
      }

      // fallback: show raw line if parsing failed
      if ((!eastName || !westName) && m.raw) {
        const rawDiv = document.createElement('div');
        rawDiv.className = 'raw';
        rawDiv.textContent = m.raw;
        matchDiv.appendChild(rawDiv);
      }

      container.appendChild(matchDiv);
    });

  } catch (err) {
    document.getElementById('matches').textContent = "Error loading matches: " + err;
    console.error(err);
  }
}

// Load the matches when the page loads
loadMatches();
</script>
</body>
</html>
