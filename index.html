<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sumo Scrandle</title>
<style>
  body { font-family: system-ui, sans-serif; background: #0b1220; color: #eee; padding: 20px; }
  h1 { margin-top: 0; }
  .match {
    display: flex; 
    flex-direction: column; 
    padding: 10px; 
    margin-bottom: 10px; 
    background: #202a3a; 
    border-radius: 6px;
  }
  .bout-header { font-weight: bold; margin-bottom: 5px; }
  label { display: block; margin: 2px 0; cursor: pointer; }
  input[type="radio"] { margin-right: 5px; }
  .correct { background: #144c26; }
  .wrong { background: #5a1c1c; }
  .raw { font-style: italic; color: #aaa; margin-top: 3px; }
</style>
</head>
<body>
<h1>Sumo Scrandle</h1>
<p>Pick the winners for todayâ€™s Makuuchi bouts!</p>
<div id="matches"></div>

<script>
const keyPrefix = 'sumo-picks-';

async function loadMatches() {
  const res = await fetch('matches.json');
  const data = await res.json();
  const matches = data.matches;
  const key = `${keyPrefix}${data.banzuke}-${data.day}`;
  let saved = JSON.parse(localStorage.getItem(key) || '{}');

  const container = document.getElementById('matches');
  container.innerHTML = '';

  matches.forEach((m, i) => {
    const matchDiv = document.createElement('div');
    matchDiv.className = 'match';

    const header = document.createElement('div');
    header.className = 'bout-header';
    header.textContent = `Bout ${m.bout}`;
    matchDiv.appendChild(header);

    // Determine names to display
    const eastName = m.east || (m.raw ? m.raw.split(' vs ')[0] : 'East');
    const westName = m.west || (m.raw ? m.raw.split(' vs ')[1] : 'West');

    // Create radio buttons
    [ [eastName,'East'], [westName,'West'] ].forEach(([name, side]) => {
      const label = document.createElement('label');
      const input = document.createElement('input');
      input.type = 'radio';
      input.name = `match-${i}`;
      input.value = name;
      if (saved[i] === name) input.checked = true;
      input.addEventListener('change', () => {
        saved[i] = name;
        localStorage.setItem(key, JSON.stringify(saved));
        updateMatchColor(matchDiv, name, m.winner);
      });
      label.appendChild(input);
      label.append(` ${name} (${side})`);
      matchDiv.appendChild(label);
    });

    // Show raw line if parsing failed
    if (!m.east || !m.west) {
      const rawDiv = document.createElement('div');
      rawDiv.className = 'raw';
      rawDiv.textContent = m.raw;
      matchDiv.appendChild(rawDiv);
    }

    // Update color if winner is known
    if (m.winner) {
      const picked = saved[i];
      updateMatchColor(matchDiv, picked, m.winner);
      const result = document.createElement('div');
      result.textContent = `Winner: ${m.winner}`;
      matchDiv.appendChild(result);
    }

    container.appendChild(matchDiv);
  });
}

function updateMatchColor(div, picked, winner) {
  div.classList.remove('correct','wrong');
  if (!winner || !picked) return;
  if (picked === winner) {
    div.classList.add('correct');
  } else {
    div.classList.add('wrong');
  }
}

loadMatches();
</script>
</body>
</html>
